@model MotoBikeManage.Models.Vehicle

@{
    ViewBag.Title = "Edit";
    //Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
    Layout = null;
}

<style>
    .edit-form-card {
        background: #fff;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
    }

    .form-group {
        margin-bottom: 15px;
    }

    .form-label {
        font-weight: 600;
        color: #555;
    }

    .form-control[readonly] {
        background-color: #e9ecef;
        opacity: 1;
    }

    .btn-submit {
        background-color: #007bff;
        color: #fff;
        border: none;
        margin-right: 10px;
    }

        .btn-submit:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }
</style>

<div class="container my-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="edit-form-card">
                <h2 class="mb-4">Chỉnh sửa thông tin xe</h2>

                @using (Html.BeginForm("Edit", "Vehicles", FormMethod.Post, new { id = Model.vehicle_id, enctype = "multipart/form-data" }))
                {
                    @Html.AntiForgeryToken()

                    <!-- Hidden ID -->
                    @Html.HiddenFor(m => m.vehicle_id)

                    <!-- Thông tin chỉ xem -->
                    <div class="form-group">
                        <label class="form-label">Số khung</label>
                        @Html.TextBoxFor(m => m.frame_number, new { @class = "form-control", @readonly = "readonly" })
                    </div>
                    <div class="form-group">
                        <label class="form-label">Số máy</label>
                        @Html.TextBoxFor(m => m.engine_number, new { @class = "form-control", @readonly = "readonly" })
                    </div>
                    <div class="form-group">
                        <label class="form-label">Năm sản xuất</label>
                        @Html.TextBoxFor(m => m.manufacture_year, new { @class = "form-control", @readonly = "readonly" })
                    </div>
                    <div class="form-group">
                        <label class="form-label">Ngày nhập</label>
                        @Html.TextBoxFor(m => m.created_at, new { @class = "form-control", @readonly = "readonly" })
                    </div>

                    <hr />

                    <!-- Thông tin cho phép chỉnh sửa -->
                    <div class="form-group">
                        <label class="form-label">Tên xe</label>
                        @Html.TextBox("name", Model.name, new { @class = "form-control change-check" })
                    </div>
                    <div class="form-group">
                        <label class="form-label">Nhãn hiệu</label>
                        @Html.TextBox("brand", Model.brand, new { @class = "form-control change-check" })
                    </div>
                    <div class="form-group">
                        <label class="form-label">Loại xe</label>
                        @Html.TextBox("model", Model.model, new { @class = "form-control change-check" })
                    </div>
                    <div class="form-group">
                        <label class="form-label">Màu sắc</label>
                        @Html.TextBox("color", Model.color, new { @class = "form-control change-check" })
                    </div>
                    <div class="form-group">
                        <label class="form-label">Hiện trạng</label>
                        @Html.TextBox("status", Model.status, new { @class = "form-control change-check" })
                    </div>
                    <div class="form-group">
                        <label class="form-label">Hình ảnh</label><br />
                        <img src="@Url.Content(Model.image)" alt="Ảnh xe" width="80" class="mb-2" />
                        <input type="file" name="uploadImage" class="form-control change-check" />
                    </div>

                    <button type="submit" id="btnSubmit" class="btn btn-submit" disabled>Lưu</button>
                    <a href="@Url.Action("Index", "Vehicles")" class="btn btn-secondary">Hủy</a>
                }
            </div>
        </div>
    </div>
</div>

<!-- Thêm thư viện JS (nếu chưa có trong Layout) -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js"></script>
<script>
    // Khóa nút Lưu nếu chưa có thay đổi
    $(document).ready(function () {
        var originalValues = {
            name: '@Model.name',
            brand: '@Model.brand',
            model: '@Model.model',
            color: '@Model.color',
            status: '@Model.status'
        };

        // Sự kiện change/input
        $('.change-check').on('input change', function () {
            // Lấy giá trị hiện tại
            var currentVals = {
                name: $('input[name="name"]').val(),
                brand: $('input[name="brand"]').val(),
                model: $('input[name="model"]').val(),
                color: $('input[name="color"]').val(),
                status: $('input[name="status"]').val()
            };

            // Kiểm tra file input
            var fileChanged = $('input[name="uploadImage"]')[0].files.length > 0;

            // So sánh
            var textChanged =
                currentVals.name !== originalValues.name ||
                currentVals.brand !== originalValues.brand ||
                currentVals.model !== originalValues.model ||
                currentVals.color !== originalValues.color ||
                currentVals.status !== originalValues.status;

            if (textChanged || fileChanged) {
                $('#btnSubmit').prop('disabled', false);
            } else {
                $('#btnSubmit').prop('disabled', true);
            }
        });
    });
</script>